var PrismSlider=(function(window,undefined){'use strict';function PrismSlider(settings){this.settings=settings;this.container=settings.container.element;this.slides=settings.slides.slice();this.slidesLength=this.slides.length;this.mask=settings.mask;this.duration=settings.duration;this.easing=settings.easing;this.slidesIndex=0;this.prevSlidesIndex=0;this.indexOffset=1;this.isAnimated=false;}
PrismSlider.prototype.init=function(){this.addCanvas_();if(this.mask)this.addMask_();setTimeout(this.addSlides_.bind(this),0);};PrismSlider.prototype.addCanvas_=function(){this.canvas=document.createElement('canvas');this.context=this.canvas.getContext('2d');this.canvas.width=this.settings.container.sizes.w;this.canvas.height=this.settings.container.sizes.h;this.container.appendChild(this.canvas);};PrismSlider.prototype.addMask_=function(){var path=this.mask.source;var callback=this.renderMask_.bind(this);this.mask.source=this.loadImage_(path,callback);};PrismSlider.prototype.addSlides_=function(){this.slides.forEach(function(path,i){var callback=(i===0)?this.renderSlide_.bind(this,i):null;this.slides[i]=this.loadImage_(path,callback);},this);};PrismSlider.prototype.loadImage_=function(path,callback){var image=new Image();image.onload=callback;image.src=path;return image;};PrismSlider.prototype.renderMask_=function(){var centerX=this.canvas.width/2-this.settings.container.sizes.w/2;var centerY=this.canvas.height/2-this.settings.container.sizes.h/2;var w=this.settings.container.sizes.w;var h=this.settings.container.sizes.h;this.context.drawImage(this.mask.source,centerX,centerY,w,h);};PrismSlider.prototype.renderSlide_=function(i,progress){progress=(isNaN(progress)||progress===undefined)?0:progress;var slide=this.slides[i];var x=this.canvas.width*(i-progress);var y=0;var w=this.canvas.width;var h=this.canvas.height;if(this.mask)this.context.globalCompositeOperation='source-atop';this.context.save();if(this.mask)this.applyEffects_();this.context.drawImage(slide,x,y,w,h);this.context.restore();};PrismSlider.prototype.applyEffects_=function(){if(this.mask.effects.flip)this.flip_();if(this.mask.effects.rotate>0)this.rotate_();};PrismSlider.prototype.flip_=function(){var axes=this.mask.effects.flip;if(axes==='X'){this.context.translate(this.canvas.width,0);this.context.scale(-1,1);}
if(axes==='Y'){this.context.translate(0,this.canvas.height);this.context.scale(1,-1);}};PrismSlider.prototype.rotate_=function(){var radians=this.mask.effects.rotate*(Math.PI/180);this.context.translate(this.canvas.width/2,this.canvas.height/2);this.context.rotate(radians);this.context.translate(-this.canvas.width/2,-this.canvas.height/2);};PrismSlider.prototype.slideTo=function(index){if(this.isAnimated||index===this.slidesIndex)return;this.prevSlidesIndex=this.slidesIndex;this.slidesIndex=index;var indexOffset=(this.prevSlidesIndex-this.slidesIndex)*-1;this.indexOffset=(indexOffset>0)?indexOffset:indexOffset*-1;this.animate_();};PrismSlider.prototype.animate_=function(){var end=Date.now()+this.duration;this.isAnimated=true;this.ticker_(end);};PrismSlider.prototype.ticker_=function(end){var now=Date.now();var remaining=end-now;var easing=this.easing(remaining/this.duration)*this.indexOffset;var i,progress,slide;if(this.slidesIndex>this.prevSlidesIndex){progress=this.slidesIndex-easing;for(i=0;i<=this.indexOffset;i++){slide=this.slidesIndex-i;this.renderSlide_(slide,progress);}}else{progress=this.slidesIndex+easing;for(i=0;i<=this.indexOffset;i++){slide=this.slidesIndex+i;this.renderSlide_(slide,progress);}}
if(remaining<50){this.indexOffset=1;this.renderSlide_(this.slidesIndex);this.isAnimated=false;return;}
window.requestAnimationFrame(this.ticker_.bind(this,end));};return PrismSlider;})(window);